<!-- <?php
  session_start(); 
  include_once $_SERVER['DOCUMENT_ROOT'].'/abcmall/admin/inc/dbcon.php';
?> -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- style -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
  integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
  crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"
  integrity="sha512-NmLkDIU1C/C88wi324HBc+S2kLhi08PN5GDeUVVVC/BVt/9Izdsc9SVeVfA1UZbY3sHUlDSyRXhCzHfr6hmPPw=="
  crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css" integrity="sha512-ELV+xyi8IhEApPS/pSj66+Jiw+sOT1Mqkzlh8ExXihe4zfqbWkxPRi8wptXIO9g73FSlhmquFlUOuMSoXz5IRw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="../../common.css" rel="stylesheet">
  <link href="../css/style.css" rel="stylesheet">
  <!-- script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <!-- <title><?php if(isset($title)){echo $title;}else{echo 'home';} ?>KEEP CODING</title> -->
  <title>KEEP CODING</title>
</head>
<body>
  <!-- <?php  
  if(isset($_SESSION['AUID'])){
    if($_SESSION['AUID'] == 'admin'){
  ?> -->
  <nav class="navbar">
    <div class="nav_top container-fluid">
      <h1 class="logo"><a href="index.html"><span>keep coding</span></a></h1>
      <div class="d-flex align-items-center">
        <div class="d-flex gap-3 align-items-center">
          <span><i class="bi bi-bell mc-gray3"></i></span>
          <div class="user d-flex align-items-center gap-3">
            <p class="mc-gray3">총관리자</p>
            <img src="../img/Ellipse 3.png" alt="">
          </div>
        </div>
      </div>
    </div>
    <div class="nav_side navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">대시보드</a>
        </li>
        <li>
          <ul>
            <li class="nav-item">
              <a class="nav-link" href="#">카테고리 관리</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" aria-disabled="true">강좌 관리</a>
            </li>
          </ul>
        </li>
        <li>
          <ul>
            <li class="nav-item">
              <a class="nav-link" href="#">강사 관리</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" aria-disabled="true">수강생 관리</a>
            </li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="#">쿠폰 관리</a>
        </li>
        <li>
          <ul>
            <li class="nav-item">
              <a class="nav-link" href="#">공지사항</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" aria-disabled="true">Q&A 게시판</a>
            </li>
          </ul>
        </li>
      </ul>
      <ul>
        <li class="nav-item d-flex justify-content-between">
          <a class="nav-link mc-b-rgba" aria-current="page" href="#">로그아웃</a>
          <a class="nav-link mc-b-rgba" aria-current="page" href="#"><i class="bi bi-gear-wide-connected"></i></a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="content">
    <form action="">
      <div class="row">
        <div class="col-md-4">
          <ul class="list-group" id="cate1">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <option disabled>대분류</option>
            </li>
            <!-- <?php
              foreach($cate1 as $c){            
            ?> -->
              <li class="list-group-item d-flex justify-content-between align-items-center" data-value="<?php echo $c->code ?>">
                <div>
                  <a href="#" class="btn-edit btn-sm mr-2">수정</a>
                  <a href="#" class="btn-delete btn-sm">삭제</a>
                </div>
              </li>
            <!-- <?php } ?> -->
          </ul>
        </div>
        <div class="col-md-4">
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center" id="cate2">
                <option selected disabled>중분류</option>   
            </li>
            <!-- <?php
  
              $query = "select * from category where step=1";
              $result = $mysqli -> query($query);
  
              while($rs = $result -> fetch_object()){
                  $cate2[] = $rs;
              }
                  foreach($cate2 as $p){            
            ?> -->
              <li class="list-group-item d-flex justify-content-between align-items-center" data-value="">
                <!-- <?php echo $p->name ?> -->
                <div>
                  <a href="#" class="btn-edit btn-sm mr-2">수정</a>
                  <a href="#" class="btn-delete btn-sm">삭제</a>
                </div>
              </li>
            <!-- <?php } ?> -->
          </ul>
        </div>
        <div class="col-md-4">
          <ul ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center" id="cate3">
              <option selected disabled>소분류</option>
            </li>
          </ul>
        </div>
        <div class="btns mt-5 row g-5">
          <div class="col d-flex justify-content-center">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cate1Modal">대분류 등록</button>
          </div>
          <div class="col d-flex justify-content-center">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cate2Modal">중분류 등록</button>
          </div>
          <div class="col d-flex justify-content-center">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cate3Modal">소분류 등록</button>
          </div>
        </div><!-- //btns -->
      </div>
    </form>
    <!-- Modal 1 -->
    <div class="modal fade" id="cate1Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fs-5">대분류 등록</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <input type="text" class="form-control" name="code1" id="code1" placeholder="코드명">
              </div>
              <div class="col-md-6">
              <input type="text" class="form-control" name="name1" id="name1" placeholder="대분류명">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="submit" class="btn btn-primary" data-step="1">등록</button>
          </div>
        </div>
      </div>
    </div> <!-- //Modal 1 -->
    <!-- Modal 2 -->
    <div class="modal fade" id="cate2Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fs-5">중분류 등록</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <!-- <?php
    
                    $query = "select * from category where step=1";
                    //$mysqli->함수명,   쿼리실행 $mysqli -> query(sql지시문);
                    $result = $mysqli -> query($query); //쿼리실행결과를 $result 할당
    
                    while($rs = $result -> fetch_object()){
                        $cate2[] = $rs;
                    }
              ?> -->
              <div class="col-md-12">
                <select class="form-select" aria-label="Default select example" id="pcode2">
                  <option selected disabled>대분류를 선택해주세요.</option>
                  <option value=""></option>
                </select>
              </div>          
            </div>
            <div class="row mt-3">
              <div class="col-md-6">
                <input type="text" class="form-control" name="code2" id="code2" placeholder="코드명">
              </div>
              <div class="col-md-6">
              <input type="text" class="form-control" name="name2" id="name2" placeholder="중분류명">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="submit" class="btn btn-primary" data-step="2">등록</button>
          </div>
        </div>
      </div>
    </div> <!-- //Modal 2 -->
    <!-- Modal 3 -->
    <div class="modal fade" id="cate3Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fs-5">소분류 등록</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <select class="form-select" aria-label="Default select example" id="pcode2_1">
                <option selected disabled>대분류</option>
                <!-- <?php
                  foreach($cate1 as $c){            
                ?> -->
                  <option value=""></option>
                  <!-- <?php echo $c->code ?> -->
                  <!-- <?php echo $c->name ?> -->
                </option>
                <!-- <?php } ?> -->
                </select>
              </div>
              <div class="col-md-6">
                <select class="form-select" aria-label="Default select example" id="pcode3">
                  <option selected disabled>대분류를 먼저 선택해주세요</option>
                
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <input type="text" class="form-control" name="code3" id="code3" placeholder="코드명">
              </div>
              <div class="col-md-6">
              <input type="text" class="form-control" name="name3" id="name3" placeholder="소분류명">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="submit" class="btn btn-primary" data-step="3">등록</button>
          </div>
        </div>
      </div>
    </div> <!-- //Modal 3 -->
  </div> <!-- //content 1 -->

  <!-- <?php
      }
    }
  ?> -->

<!-- script -->
<script>
  $(document).ready(function () {
    // 대분류 list-group-item을 클릭했을 때
    $('.list-group-item[data-value]').on('click', function () {
      let selectedCateCode = $(this).data('value');
      $('#pcode2').val(selectedCateCode); // 중분류 select 엘리먼트의 값을 설정
      
      // 변경 이벤트를 트리거하여 종속 요소가 업데이트되도록 함
      $('#pcode2').trigger('change');
    });

    // 중분류 select의 값이 변경되었을 때
    $('#pcode2').on('change', function () {
      let selectedPCode = $(this).val();
      $('#pcode3 option').each(function () {
        $(this).prop('disabled', true); // 모든 옵션 비활성화
      });

      // 선택한 값과 일치하는 옵션 활성화
      $('#pcode3 option[value="' + selectedPCode + '"]').prop('disabled', false);
    });
  });
</script>
<script src="../../js/makeoption.js"></script>
<script>

  let categorySubmitBtn = $('.modal button[type="submit"]');

  categorySubmitBtn.click(function(){
    let step = $(this).attr('data-step');
    save_category(step);
  });

  function save_category(step){
    let code = $(`#code${step}`).val(); //$('#code1').val()
    let name = $(`#name${step}`).val();
    let pcode = $(`#pcode${step} option:selected`).val();

    if(step > 1 && !pcode){
      alert('대분류를 먼저 선택하세요');
      return; //아무것도 반환하지 않고 종료
    }    
    if(!code){
      alert('코드명을 입력하세요');
      return; 
    }
    if(!name){
      alert('분류명을 입력하세요');
      return; 
    }
    let data = {
      name:name,
      code:code,
      pcode:pcode,
      step:step
    }
    console.log(data);
    
    $.ajax({
      async : false, 
      type: 'post',     
      data: data, 
      url: "save_category.php", 
      dataType: 'json', //결과 json 객체형식
      error: function(error){
        console.log('Error:', error);
      },
      success: function(return_data){
        console.log(return_data.result);

        if(return_data.result == 1){
          alert('등록성공');
        } else if(return_data.result == -1){
          alert('코드나 분류명이 이미 사용중입니다.');
          location.reload();//새로고침
        } else{
          alert('등록실패');
        }
      }
    });//ajax


  }


</script>

</body>
</html>

